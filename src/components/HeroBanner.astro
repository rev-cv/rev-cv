---
import SVGMail from "../assets/email.svg";
import SVGGitHub from "../assets/github.svg";
import SVGTelegram from "../assets/telegram.svg";
import contacts from "../data/contacts.json";

/**
 * Props компонента HeroBanner
 * @interface Props
 */
interface Props {
    /** Данные текущей роли портфолио */
    resume: {
        jobtitle: string;
        description: string;
        url: string;
    };
}

const { resume } = Astro.props;

import type { TypePortfoliosGlob } from "../types/TypePortfolio";

/**
 * Загружает все JSON файлы портфолио из папки portfolios
 * Использует import.meta.glob для динамической загрузки
 */
const portfoliosJSON: TypePortfoliosGlob = import.meta.glob(
    "../data/portfolios/*.json",
    {
        eager: true,
    }
);

/**
 * Массив портфолио с базовой информацией для навигации
 * Содержит только jobtitle и url для отображения в меню
 */
const portfolios = [];

for (const path in portfoliosJSON) {
    const portfolio = portfoliosJSON[path].default;
    portfolios.push({
        jobtitle: portfolio.jobtitle,
        url: portfolio.url,
    });
}
---

<div class="hero-banner">
    <picture class="hero-banner__bg">
        <img
            src={`${import.meta.env.BASE_URL}hero-banner-bg.webp`}
            alt="textured background"
        />
    </picture>
    <div class="hero-banner__content container">
        <div class="hero-banner__my-name">Revin Roman</div>
        <div class="hero-banner__my-job">
            <button><h1>{resume.jobtitle}</h1></button>
            <div>
                <div>
                    {
                        portfolios.map((portfolio) =>
                            portfolio.jobtitle === resume.jobtitle ? null : (
                                <a
                                    href={`${import.meta.env.BASE_URL}${portfolio.url}`}
                                >
                                    {portfolio.jobtitle}
                                </a>
                            )
                        )
                    }
                </div>
            </div>
        </div>
        <div class="hero-banner__descr">{resume.description}</div>

        <div class="hero-banner__btns">
            <button id="move-to-cases">Мои проекты</button>
            <button id="move-to-contacts">Связаться со мной</button>
        </div>

        <div class="hero-banner__social-media">
            <a
                href={contacts.github.contact}
                target="_blank"
                rel="noopener noreferrer"
                title={contacts.github.title}
            >
                <SVGGitHub />
            </a>
            <a
                href={contacts.email.contact}
                target="_blank"
                rel="noopener noreferrer"
                title={contacts.email.title}
            >
                <SVGMail />
            </a>
            <a
                href={contacts.telegram.contact}
                target="_blank"
                rel="noopener noreferrer"
                title={contacts.telegram.title}
            >
                <SVGTelegram />
            </a>
        </div>

        <div class="hero-banner__my-touch">
            Любитель чистого кода и хорошего чая.
        </div>
        <picture class="hero-banner__avatar">
            <img
                src={`${import.meta.env.BASE_URL}2025-09-17.webp`}
                alt="my photo"
            />
        </picture>
    </div>
</div>

<style lang="scss">
    .hero-banner {
        padding: 20px;
        text-align: center;
        height: calc(100vh - 6em);
        height: 100vh;
        margin-top: -6em;

        position: relative;
        overflow: hidden;

        display: flex;
        flex-direction: column;
        justify-content: center;

        h1 {
            font-size: 1em;
        }

        &__bg {
            position: absolute;

            inset: 0;
            background-position: center;
            background-color: var(--color-black);

            img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                opacity: 0.3;
            }
        }

        &__content {
            z-index: 3;
            position: relative;

            display: grid;
            grid-template-columns: 1.2fr 1fr;
            grid-template-areas:
                "name avatar"
                "job avatar"
                "descr avatar"
                "btns avatar"
                "media touch";
            grid-template-rows: 1fr auto 1fr auto auto;

            gap: 0 1em;
        }

        &__my-name {
            grid-area: name;
            justify-self: left;
            align-self: self-end;
            font-size: clamp(1.1em, 2.5vw, 1.8em);
            font-weight: 700;
            line-height: 1em;
            color: var(--color-basic-white);
        }

        &__my-job {
            grid-area: job;
            // justify-self: stretch;
            position: relative;
            z-index: 10;
            // width: 100% !important;

            > button {
                // font-size: 2.2em;
                font-size: clamp(1.3em, 3vw, 2.2em);

                font-weight: 800;
                line-height: 1em;
                color: var(--color-azure);
                padding: 0.5em 0;
                cursor: pointer;
                transition:
                    color 300ms ease-in-out,
                    transform 200ms ease-in-out;
                text-align: left;

                display: flex;
                justify-content: stretch;

                &:hover {
                    color: var(--color-azure-light);
                    transform: translateY(-2px);
                }
            }

            > div {
                position: absolute;
                width: 100%;
                padding: 0.5em;

                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: 0fr;

                transition: grid-template-rows 300ms ease-in-out;

                > div {
                    display: flex;
                    flex-direction: column;
                    gap: 0.5em;
                    overflow: hidden;
                    transform-origin: top left;
                    transition: transform 300ms ease-in-out 100ms;

                    a {
                        width: 80%;
                        background-color: var(--color-azure);
                        padding: 0.5em 0.3em 0.3em 0.3em;
                        transition:
                            margin-left 300ms ease-in-out 200ms,
                            background-color 300ms ease-in-out;
                        color: var(--color-black);
                        font-weight: 600;
                        text-transform: uppercase;
                        text-decoration: none;
                        font-size: clamp(0.65em, 1.5vw, 1em);

                        &:hover {
                            background-color: var(--color-azure-light);
                        }
                    }
                }
            }
        }

        &__my-job.active {
            > div {
                grid-template-rows: 1fr;

                > div {
                    transform: rotate(3deg);
                }
            }
        }

        &__my-job.remove-transition {
            > div {
                opacity: 0;
                transition: opacity 300ms ease-in-out;
            }
        }

        &__my-touch {
            grid-area: touch;
            justify-self: center;
            font-size: 0.7em;
            font-style: italic;
            color: var(--color-basic-white-80);
            padding: 2em;
            text-align: center;
            opacity: 0;
        }

        &__descr {
            grid-area: descr;
            align-self: self-start;
            text-align: left;
            color: var(--color-basic-white-80);
            font-size: clamp(0.7em, 1.5vw, 0.9em);
            font-weight: 300;
            line-height: 1.4em;
            padding-bottom: 1.2em;
        }

        &__avatar {
            grid-area: avatar;
            justify-self: center;
            align-self: center;

            width: clamp(10em, 35vw, 25em);
            height: clamp(10em, 35vw, 25em);
            border-radius: 50%;
            margin-top: 20px;
            overflow: hidden;
            border: 0.4em solid var(--color-basic-white-80);
            pointer-events: none;

            position: relative;

            img {
                transform: scaleX(-1);
            }
        }

        &__social-media {
            grid-area: media;
            justify-self: start;
            align-self: center;

            color: var(--color-basic-white);
            display: flex;
            justify-content: center;
            gap: 0.5em;

            a {
                display: flex;
                color: var(--color-basic-white-80);
                background-color: transparent;
                padding: 0.3em;
                border-radius: 3px;
                overflow: hidden;
                position: relative;
                transition:
                    background-color 300ms ease-in-out,
                    color 300ms ease-in-out transform 300ms ease-in-out;

                &:hover {
                    background-color: var(--color-button-hover-bg);
                    color: var(--color-azure);
                }

                svg {
                    width: 1.2em;
                    height: 1.2em;
                }
            }
        }

        &__btns {
            grid-area: btns;
            justify-self: left;
            align-self: self-end;

            display: flex;
            gap: 1em;

            button {
                padding: 0.5em 1em;
                border: none;
                border-radius: 6px;
                background-color: var(--color-bg);
                color: var(--color-basic-white-80);
                cursor: pointer;
                user-select: none;
                overflow: hidden;

                font-size: clamp(0.63em, 1.5vw, 1em);
                font-weight: 500;

                transition:
                    color 300ms ease-in-out,
                    transform 200ms ease-in-out,
                    background-color 300ms ease-in-out;
                position: relative;

                &::after {
                    position: absolute;
                    inset: 0;
                    content: "";
                    background-color: transparent;
                    transition: background-color 300ms ease-in-out;
                }

                &:hover {
                    color: var(--color-azure);
                    background-color: #000;
                    transform: translateY(-2px);

                    &::after {
                        background-color: var(--color-button-hover-bg);
                    }
                }
            }
        }

        &::after {
            content: "";
            pointer-events: none;
            position: absolute;
            inset: 0;
            background-color: var(--color-azure);
            border-radius: 50%;
            width: 30em;
            height: 30em;
            filter: blur(500px);
            z-index: 1;
        }

        &::before {
            content: "";
            pointer-events: none;
            position: absolute;
            right: 0;
            bottom: 0;
            background-color: rgb(0, 0, 0);
            // opacity: 0.3;
            border-radius: 50%;
            width: 30em;
            height: 30em;
            filter: blur(500px);
            z-index: 2;
        }
    }

    $offset-step: 2%;

    @for $i from 1 through 10 {
        .hero-banner__my-job.active > div > div > a:nth-child(#{$i}) {
            margin-left: ($offset-step * $i);
        }
    }

    @media (max-width: 860px) {
        .hero-banner {
            padding-top: 100px;

            &__content {
                grid-template-columns: 1fr;

                grid-template-areas:
                    "avatar"
                    "name"
                    "job"
                    "descr"
                    "btns"
                    // "media"
                    "touch";
                grid-template-rows: inherit;
                gap: clamp(0.3em, 2vh, 1em) 0;

                > div {
                    justify-self: center;
                }
            }

            &__my-name {
                padding-top: 1em;
            }

            &__my-job {
                button {
                    text-align: center;
                }
            }

            &__descr {
                text-align: center;
                max-width: 600px;
            }

            &__btns {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.5em;
            }

            &__social-media {
                display: none;
            }
        }
    }

    @media (max-width: 530px) {
        .hero-banner {
            &__btns {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1em;

                button {
                    display: flex;
                    flex-wrap: nowrap;
                }
            }
        }
    }
</style>

<script>
    /**
     * Инициализация интерактивности HeroBanner при загрузке DOM
     * Управляет переключением меню портфолио и обработкой кликов
     */
    window.addEventListener("DOMContentLoaded", () => {
        const myJob = document.querySelector(".hero-banner__my-job");
        if (!myJob) return;

        /**
         * Скрывает список портфолио с анимацией
         * Добавляет класс для плавного скрытия, затем убирает активный класс
         */
        function hideListPortfolio() {
            if (!myJob) return;
            myJob.classList.add("remove-transition");
            setTimeout(() => {
                myJob.classList.remove(activeClass);
                setTimeout(() => {
                    myJob.classList.remove("remove-transition");
                }, 300);
            }, 300);
        }

        /** CSS класс для активного состояния меню */
        const activeClass = "active";

        /**
         * Обработчик клика по кнопке роли
         * Переключает видимость списка портфолио
         */
        myJob.addEventListener("click", () => {
            if (myJob.classList.contains(activeClass)) {
                hideListPortfolio();
            } else {
                myJob.classList.add(activeClass);
            }
        });

        /**
         * Обработчик клика вне блока меню
         * Скрывает меню при клике в любом месте страницы
         */
        document.addEventListener("mousedown", (event) => {
            if (
                myJob.classList.contains(activeClass) &&
                !(event.target instanceof Node && myJob.contains(event.target))
            ) {
                hideListPortfolio();
            }
        });

        document
            .querySelector("#move-to-cases")
            ?.addEventListener("click", () => {
                const block = document.querySelector(".portfolio-cases");
                if (block) {
                    block.scrollIntoView({ behavior: "smooth" });
                }
            });

        document
            .querySelector("#move-to-contacts")
            ?.addEventListener("click", () => {
                const block = document.querySelector("#block-contacts");
                if (block) {
                    block.scrollIntoView({ behavior: "smooth" });
                }
            });
    });
</script>
