---
// import Layout from "../layouts/Layout.astro";
import type { TypePortfoliosGlob, PortfolioItem } from "../types/TypePortfolio";

// все JSON файлы портфолио из папки portfolios
// import.meta.glob для динамической загрузки
const portfoliosJSON: TypePortfoliosGlob = import.meta.glob(
    "../data/portfolios/*.json",
    {
        eager: true,
    }
);

// массив всех доступных портфолио
const allPortfolios: PortfolioItem[] = [];
for (const path of Object.keys(portfoliosJSON)) {
    const portfolio = portfoliosJSON[path].default;
    allPortfolios.push(portfolio);
}

// перенаправление на первое доступное резюме
if (allPortfolios.length > 0) {
    // Используем import.meta.env.BASE_URL и добавляем слэш в конце
    // для совместимости с `trailingSlash: 'always'`.
    const redirectUrl = `${import.meta.env.BASE_URL}${allPortfolios[0].url}`;
    return Astro.redirect(redirectUrl);
    // Если резюме нет, перенаправляем на about-me
} else {
    return Astro.redirect(`${import.meta.env.BASE_URL}about-me`);
}
---
