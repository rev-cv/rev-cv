---
import Layout from "../../layouts/Layout.astro";
import CasesExplorer from "../../components/CasesExplorer.svelte";
import { getCollection } from "astro:content";

// все кейсы
const allCaseEntries = await getCollection("cases");
const allCases = allCaseEntries.map((entry) => ({
    metadata: {
        url: entry.slug, // Используем slug как уникальный идентификатор
        tech: entry.data.tech,
        title: entry.data.title,
        descr: entry.data.descr,
        cover: entry.data.cover,
    },
}));

// все портфолио для получения списка ролей
const allPortfolioEntries = await getCollection("portfolios");
const portfoliosForFilter = allPortfolioEntries.map((entry) => ({
    url: entry.data.url,
    jobtitle: entry.data.jobtitle,
    cases: entry.data.cases,
}));

// сборка списка уникальных тегов из всех кейсов
const allTags = [...new Set(allCases.flatMap((c) => c.metadata.tech))].sort();

// данные для фильтров
const filtersData = {
    roles: portfoliosForFilter.map((p) => ({ id: p.url, name: p.jobtitle })),
    tags: allTags,
};
---

<Layout
    title="Все кейсы"
    description="Обзор всех выполненных проектов с возможностью фильтрации и поиска."
>
    <div class="cases-all container">
        <div class="cases-all__header">
            <h1>Кейсы</h1>
            <p>От идеи до реализации: посмотрите, как создавались проекты.</p>
        </div>
        <CasesExplorer
            client:load
            {allCases}
            {filtersData}
            allPortfolios={portfoliosForFilter}
        />
    </div>
</Layout>

<style lang="scss">
    @use "../../styles/h1-title" as *;

    .cases-all {
        display: flex;
        flex-direction: column;

        &__header {
            padding: 2em 0;
            text-align: center;
            @include title-h1;
        }
    }
</style>
